<!--
    Copyright 2013 Aaron Curtis

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<html>
<head>
    <title>Volcanocopter flight list</title>
    <script type="text/javascript" src="/static/js/timeline.js"></script>
    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.scrollIntoView.min.js"></script>        
    <link rel="stylesheet" type="text/css" href="http://almende.github.com/chap-links-library/js/timeline/timeline.css">
    <link rel="stylesheet" type="text/css" href="/static/css/flightList.css">
</head>

<body>

<h1>Flight data overview</h1>

<table id="flights-table">
    <tr class="table-header">
        <th>Logfile</th>
        <th>Length</th>
        <th>Comments</th>
    </tr>
    <!-- To keep the table header floating above the table, we use position: fixed
    in the css. Then we need this blank table row -->
    <tr><td height="20px"></td></tr>

    {% for flight in object_list %}
        <tr>
            <td><a href=/flight/{{flight.slug}}>Log {{flight.id}} </a></td>
            <td>{% if flight.length %}{{flight.length}}{% endif %}</td>
            <td>{{flight.comments}}</td>
            <td>{{flight.gpsTimes.0}}</td>
        </tr>
    {% endfor %}
    </table>
</table>

<div id="mytimeline"></div>

<div id="info"></div>


    <script type="text/javascript">
        var timeline;
        var data;
        function drawTimeline() {
            //Drawing the timeline of all flights
            data = {{timeline_data|safe}}
            var options = {
                'width':  '100%',
                'height': '300px',
                'editable': false,
                'style': 'box'
            };
            timeline = new links.Timeline(document.getElementById('mytimeline'));
            timeline.draw(data, options);
        };
        function highlightFlightInTable(event){
            flightsTableEntry=$("#flights-table>tbody>tr:contains(Log "+event.target.textContent+" )")
            flightsTableEntry.addClass('highlighted')
            flightsTableEntry.scrollIntoView(100)
        };
        function unHighlightFlightInTable(event){
            $("#flights-table>tbody>tr:contains(Log "+event.target.textContent+")").removeClass('highlighted')
        };
        function highlightFlightOnTL(event){
            //FIXTHIS. Should be some more direct connection between flights on the table and in the timeline.
            //Maybe draw the table from the timeline using JS.
            //Also, should only create selectors once, and then re-use them.
            event.stopPropagation();
            flightSeqNum=$("#flights-table>tbody>tr").index(event.currentTarget)
            timeline.items[flightSeqNum].select()
            return false;
        };
        function unHighlightFlightOnTL(event){
            event.stopPropagation();
            flightSeqNum=$("#flights-table>tbody>tr").index(event.currentTarget)
            timeline.items[flightSeqNum].unselect()
            return false;
        };
        $(document).ready(function() {
        drawTimeline();
        $(".timeline-event").hover(highlightFlightInTable,unHighlightFlightInTable)
        $("#flights-table>tbody>tr").hover(highlightFlightOnTL,unHighlightFlightOnTL)
        
        
                
        }
);    
    </script>
</body>
</html>
